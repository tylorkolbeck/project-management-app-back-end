# Migration `20200911005235-add-milestone-task-schema`

This migration has been generated by tylor.kolbeck@gmail.com at 9/10/2020, 5:52:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `todo_db`.`Milestone` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`title` varchar(191)  NOT NULL ,
`description` varchar(191)  NOT NULL ,
`projectId` int  ,
`dueDate` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `todo_db`.`Task` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`name` varchar(191)  NOT NULL ,
`description` varchar(191)  NOT NULL ,
`color` varchar(191)  NOT NULL ,
`dateCompleted` datetime(3)  NOT NULL ,
`priority` varchar(191)  NOT NULL ,
`sos` boolean  NOT NULL ,
`assigneeId` int  ,
`creatorId` int  ,
`dueDate` datetime(3)  NOT NULL ,
`milestoneId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `todo_db`.`_tasksAssigned` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE Index `_tasksAssigned_AB_unique`(`A`,
`B`),
Index `_tasksAssigned_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `todo_db`.`Milestone` ADD FOREIGN KEY (`projectId`) REFERENCES `todo_db`.`Project`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `todo_db`.`Task` ADD FOREIGN KEY (`assigneeId`) REFERENCES `todo_db`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `todo_db`.`Task` ADD FOREIGN KEY (`creatorId`) REFERENCES `todo_db`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `todo_db`.`Task` ADD FOREIGN KEY (`milestoneId`) REFERENCES `todo_db`.`Milestone`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `todo_db`.`_tasksAssigned` ADD FOREIGN KEY (`A`) REFERENCES `todo_db`.`Task`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `todo_db`.`_tasksAssigned` ADD FOREIGN KEY (`B`) REFERENCES `todo_db`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200910220641-remove-unique-key..20200911005235-add-milestone-task-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -25,20 +25,23 @@
   password         String
   links            Link[]
   votes            Vote[]
   projects         Project[] // Projects this User owns
-  projectsAssigned Project[] @relation("projectsAssigned") // Projects this user is a part of
+  projectsAssigned Project[] @relation("projectsAssigned") // Projects this user is a member of
+  tasksAssigned    Task[]    @relation("tasksAssigned")
+  Task             Task[]
 }
 model Project {
-  id          Int      @id @default(autoincrement())
-  createdAt   DateTime @default(now())
+  id          Int         @id @default(autoincrement())
+  createdAt   DateTime    @default(now())
   name        String
   description String
-  owner       User     @relation(fields: [ownerId], references: [id])
+  owner       User        @relation(fields: [ownerId], references: [id])
   ownerId     Int
-  assignees   User[]   @relation("projectsAssigned", fields: [assigneeId], references: [id])
+  assignees   User[]      @relation("projectsAssigned", fields: [assigneeId], references: [id])
   assigneeId  Int?
+  Milestone   Milestone[]
   @@unique([ownerId, name])
 }
 model Vote {
@@ -49,4 +52,33 @@
   userId Int
   @@unique([linkId, userId])
 }
+
+model Milestone {
+  id          Int      @id @default(autoincrement())
+  createdAt   DateTime @default(now())
+  title       String
+  description String
+  project     Project? @relation(fields: [projectId], references: [id])
+  projectId   Int?
+  dueDate     DateTime
+  tasks       Task[]
+}
+
+model Task {
+  id            Int        @id @default(autoincrement())
+  createdAt     DateTime   @default(now())
+  name          String
+  description   String
+  color         String
+  dateCompleted DateTime
+  priority      String
+  sos           Boolean
+  assigned      User[]     @relation("tasksAssigned", fields: [assigneeId], references: [id])
+  assigneeId    Int?
+  creator       User?      @relation(fields: [creatorId], references: [id])
+  creatorId     Int?
+  dueDate       DateTime
+  milestone     Milestone? @relation(fields: [milestoneId], references: [id])
+  milestoneId   Int?
+}
```


